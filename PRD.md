## Nginx + ModSecurity + OWASP CRS 기반 WAF SaaS MVP PRD

### 1. 제품 개요

본 문서는 Nginx, ModSecurity, OWASP CRS를 활용하여 Web Application Firewall (WAF) SaaS를 구축하기 위한 MVP (Minimum Viable Product)의 제품 요구사항 정의서 (Product Requirement Document, PRD)입니다. 본 WAF SaaS는 사용자 친화적인 인터페이스를 통해 웹 애플리케이션 보안을 강화하고, 커스텀 룰 생성 및 관리를 용이하게 하며, 상세한 보안 로그를 제공하여 사용자가 능동적으로 보안 위협에 대응할 수 있도록 돕습니다.

### 2. 목표 및 비전

- **목표:** 중소기업 및 개발자가 쉽게 접근하고 사용할 수 있는 클라우드 기반 WAF 솔루션 제공
- **비전:** 웹 애플리케이션 보안을 위한 표준 플랫폼으로 자리매김하여, 사용자에게 강력하고 유연한 보안 환경 제공

### 3. 대상 사용자

- **웹 개발자:** 자체 웹 애플리케이션의 보안을 강화하고자 하는 개발자
- **중소기업:** IT 보안 인프라 구축에 어려움을 겪는 중소기업
- **보안 관리자:** 웹 애플리케이션에 대한 보안 정책 수립 및 모니터링이 필요한 보안 관리자

### 4. 핵심 기능 (MVP)

#### 4.1. 사용자 인증: 구글 로그인

- **기능 설명:** 사용자는 구글 계정을 통해 WAF SaaS에 안전하고 편리하게 로그인할 수 있습니다.
- **세부 요구사항:**
  - OAuth 2.0 기반 구글 로그인 연동
  - 최초 로그인 시 사용자 계정 자동 생성
  - 로그인 상태 유지 (세션 관리)
  - 로그아웃 기능
- **이점:** 사용자 편의성 증대, 별도 회원가입 절차 불필요, 보안 강화

#### 4.2. 대시보드

사용자가 WAF 설정, 모니터링, 로그 분석 등 모든 핵심 기능에 접근할 수 있는 중앙 관리 페이지입니다.

##### 4.2.1. 커스텀 룰 생성 및 룰 CRUD (Create, Read, Update, Delete)

- **기능 설명:** 사용자는 OWASP CRS 외에 특정 애플리케이션 요구사항에 맞춰 커스텀 보안 룰을 직접 생성, 조회, 수정, 삭제할 수 있습니다.
- **세부 요구사항:**
  - **룰 생성 (Create):**
    - 룰 이름, 설명 입력 필드
    - ModSecurity Rule 언어 기반 룰 작성 에디터 (구문 강조, 자동 완성 등 편의 기능 고려)
    - 룰 활성화/비활성화 옵션
    - 룰 저장 및 배포 기능
    - 예시 룰 템플릿 제공 (IP 차단, 특정 URL 접근 제어 등)
  - **룰 조회 (Read):**
    - 생성된 룰 목록을 테이블 형태로 표시 (이름, 설명, 상태, 마지막 수정일 등)
    - 룰 검색 및 필터링 기능 (이름, 상태)
    - 개별 룰 상세 정보 확인 기능
  - **룰 수정 (Update):**
    - 기존 룰의 이름, 설명, 내용, 활성화 상태 변경 기능
    - 수정 내역 저장 및 배포 기능
  - **룰 삭제 (Delete):**
    - 선택된 룰 삭제 기능 (확인 메시지 포함)
    - 삭제된 룰 복원 기능 (선택 사항, MVP에서는 제외 가능)
  - **룰 적용 방식:**
    - 새로운 룰 생성/수정/삭제 시, Nginx ModSecurity 설정 파일에 자동으로 반영 및 Nginx reload (또는 Graceful Reload)
    - 배포 실패 시 사용자에게 알림
- **이점:** 유연한 보안 정책 수립 가능, 특정 위협에 대한 신속한 대응, WAF의 확장성 증대

##### 4.2.2. 로그 확인

- **기능 설명:** ModSecurity를 통해 탐지되거나 차단된 보안 이벤트 로그를 확인하고 분석할 수 있습니다.
- **세부 요구사항:**
  - **로그 목록:**
    - 보안 이벤트 발생 시각, 소스 IP, 요청 URL, 위협 유형, ModSecurity Rule ID, 액션 (탐지/차단) 등 핵심 정보 표시
    - 테이블 형태로 표시, 최신 로그 상단 정렬
    - 페이지네이션 및 한 페이지당 표시 개수 설정
  - **로그 검색 및 필터링:**
    - 날짜 및 시간 범위 필터링
    - 소스 IP, 요청 URL, 위협 유형, ModSecurity Rule ID, 액션 등으로 검색 및 필터링
  - **로그 상세 보기:**
    - 개별 로그 클릭 시, 전체 HTTP 요청/응답 헤더, 바디, ModSecurity 스코어, 매칭된 룰 정보 등 상세 정보 팝업 또는 별도 페이지로 표시
  - **로그 다운로드:**
    - 필터링된 로그를 CSV, JSON 등 형식으로 다운로드 기능 (선택 사항, MVP에서는 제외 가능)
- **이점:** 보안 위협에 대한 가시성 확보, 공격 패턴 분석 용이, 보안 정책 개선을 위한 데이터 제공

### 5. 와이어프레임

대시보드 구성은 다음과 같습니다.

- **상단 내비게이션 바:** 로고, 대시보드 링크, 룰 관리 링크, 로그 확인 링크, 구글 사용자 정보 (프로필 사진, 이름), 로그아웃 버튼
- **대시보드 메인 영역:**
  - **커스텀 룰 목록:**
    - "새 룰 생성" 버튼
    - 룰 검색/필터링 입력 필드
    - 룰 목록 테이블 (체크박스, 이름, 설명, 상태 (활성화/비활성화), 수정일, 액션 버튼 (수정/삭제))
  - **로그 확인 영역:**
    - 날짜/시간 필터링, IP, URL 등 검색/필터링 입력 필드
    - 로그 목록 테이블 (발생 시각, 소스 IP, 요청 URL, 위협 유형, 룰 ID, 액션 (탐지/차단), 상세 보기 버튼)

---

이 PRD는 MVP의 핵심 기능에 초점을 맞추고 있으며, 개발 진행 상황과 사용자 피드백에 따라 지속적으로 업데이트될 수 있습니다.
