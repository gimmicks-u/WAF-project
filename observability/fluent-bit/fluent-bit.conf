[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File /fluent-bit/etc/parsers_multiline.conf
    Parsers_File /fluent-bit/etc/parsers.conf

# Nginx access JSON file
[INPUT]
    Name              tail
    Path              /tmp/access.json.log
    Parser            json
    Tag               nginx.access
    Refresh_Interval  5

# Tag access stream and set source
[FILTER]
    Name    modify
    Match   nginx.access
    Add     source access

# ModSecurity audit JSON (multi-line JSON per transaction)
[INPUT]
    Name              tail
    Path              /tmp/modsec_audit.json
    Parser            modsec_json
    Tag               modsecurity.audit
    Refresh_Interval  5

[FILTER]
    Name    modify
    Match   modsecurity.audit
    Add     source waf

# Tag each stream with a source type
[FILTER]
    Name    modify
    Match   nginx.access
    Add     source access
    Rename  message log

# If collecting Docker JSON logs in the future, enable this input
# [INPUT]
#     Name              tail
#     Path              /var/lib/docker/containers/*/*-json.log
#     Parser            docker
#     Tag               docker.*
#     Refresh_Interval  5
#     Skip_Long_Lines   On
#     Mem_Buf_Limit     50MB
#     DB                /fluent-bit/state/flb.db
#     DB.Sync           normal

[FILTER]
    Name    modify
    Match   modsecurity.audit
    Add     source waf

# Ship to backend via HTTP
[OUTPUT]
    Name               http
    Match              *
    Host               backend-server
    Port               3000
    URI                /ingest/logs
    Format             json
    Json_date_key      timestamp
    Json_date_format   iso8601

# Debug output
[OUTPUT]
    Name               stdout
    Match              *

